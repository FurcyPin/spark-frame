
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Reference - Spark-frame</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/custom_width.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spark_framefunctions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Spark-frame" class="md-header__button md-logo" aria-label="Spark-frame" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Spark-frame
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Spark-frame" class="md-nav__button md-logo" aria-label="Spark-frame" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Spark-frame
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        What is spark-frame ?
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Use cases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Use cases" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Use cases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../use_cases/intro/" class="md-nav__link">
        Intro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../use_cases/working_with_nested_data/" class="md-nav__link">
        Working with nested data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../use_cases/working_with_json/" class="md-nav__link">
        Working with json
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Reference
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spark_framefunctions" class="md-nav__link">
    spark_frame.functions
  </a>
  
    <nav class="md-nav" aria-label="spark_frame.functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spark_frame.functions.empty_array" class="md-nav__link">
    empty_array()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.functions.generic_struct" class="md-nav__link">
    generic_struct()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.functions.nullable" class="md-nav__link">
    nullable()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark_framegraph" class="md-nav__link">
    spark_frame.graph
  </a>
  
    <nav class="md-nav" aria-label="spark_frame.graph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spark_frame.graph_impl.ascending_forest_traversal.ascending_forest_traversal" class="md-nav__link">
    ascending_forest_traversal()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark_frametransformations" class="md-nav__link">
    spark_frame.transformations
  </a>
  
    <nav class="md-nav" aria-label="spark_frame.transformations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spark_frame.transformations_impl.flatten.flatten" class="md-nav__link">
    flatten()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.transformations_impl.parse_json_columns.parse_json_columns" class="md-nav__link">
    parse_json_columns()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.transformations_impl.unflatten.unflatten" class="md-nav__link">
    unflatten()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.transformations_impl.with_generic_typed_struct.with_generic_typed_struct" class="md-nav__link">
    with_generic_typed_struct()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark_frameschema_utils" class="md-nav__link">
    spark_frame.schema_utils
  </a>
  
    <nav class="md-nav" aria-label="spark_frame.schema_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spark_frame.schema_utils.schema_from_json" class="md-nav__link">
    schema_from_json()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.schema_utils.schema_from_simple_string" class="md-nav__link">
    schema_from_simple_string()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.schema_utils.schema_to_json" class="md-nav__link">
    schema_to_json()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.schema_utils.schema_to_pretty_json" class="md-nav__link">
    schema_to_pretty_json()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.schema_utils.schema_to_simple_string" class="md-nav__link">
    schema_to_simple_string()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spark_framefunctions" class="md-nav__link">
    spark_frame.functions
  </a>
  
    <nav class="md-nav" aria-label="spark_frame.functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spark_frame.functions.empty_array" class="md-nav__link">
    empty_array()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.functions.generic_struct" class="md-nav__link">
    generic_struct()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.functions.nullable" class="md-nav__link">
    nullable()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark_framegraph" class="md-nav__link">
    spark_frame.graph
  </a>
  
    <nav class="md-nav" aria-label="spark_frame.graph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spark_frame.graph_impl.ascending_forest_traversal.ascending_forest_traversal" class="md-nav__link">
    ascending_forest_traversal()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark_frametransformations" class="md-nav__link">
    spark_frame.transformations
  </a>
  
    <nav class="md-nav" aria-label="spark_frame.transformations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spark_frame.transformations_impl.flatten.flatten" class="md-nav__link">
    flatten()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.transformations_impl.parse_json_columns.parse_json_columns" class="md-nav__link">
    parse_json_columns()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.transformations_impl.unflatten.unflatten" class="md-nav__link">
    unflatten()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.transformations_impl.with_generic_typed_struct.with_generic_typed_struct" class="md-nav__link">
    with_generic_typed_struct()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spark_frameschema_utils" class="md-nav__link">
    spark_frame.schema_utils
  </a>
  
    <nav class="md-nav" aria-label="spark_frame.schema_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spark_frame.schema_utils.schema_from_json" class="md-nav__link">
    schema_from_json()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.schema_utils.schema_from_simple_string" class="md-nav__link">
    schema_from_simple_string()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.schema_utils.schema_to_json" class="md-nav__link">
    schema_to_json()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.schema_utils.schema_to_pretty_json" class="md-nav__link">
    schema_to_pretty_json()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark_frame.schema_utils.schema_to_simple_string" class="md-nav__link">
    schema_to_simple_string()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="docs/reference.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>Reference</h1>

<h2 id="spark_framefunctions">spark_frame.functions</h2>
<p>Like with <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/functions.html">pyspark.sql.functions</a>, 
the methods in this module all return <a href="pyspark.sql.Column">Column</a> expressions and can be used to build operations
on Spark <a href="pyspark.sql.DataFrame">DataFrames</a> using <code>select</code>, <code>withColumn</code>, etc.</p>
<hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.functions.empty_array" class="doc doc-heading">
<code class="highlight language-python"><span class="n">empty_array</span><span class="p">(</span><span class="n">element_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataType</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Column</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Create an empty Spark array column of the specified type.
This is a workaround to the Spark method <code>typedLit</code> not being available in PySpark</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>element_type</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-external" title="pyspark.sql.types.DataType" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.types.DataType.html#pyspark.sql.types.DataType">DataType</a>, str]</code>
          </td>
          <td><p>The type of the array's element</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.Column" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Column.html#pyspark.sql.Column">Column</a></code>
          </td>
          <td><p>A Spark Column representing an empty array.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;doctest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">f</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;SELECT 1 as a&#39;&#39;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;empty_array&#39;</span><span class="p">,</span> <span class="n">empty_array</span><span class="p">(</span><span class="s2">&quot;STRUCT&lt;b: int, c: array&lt;string&gt;&gt;&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- a: integer (nullable = false)</span>
<span class="go"> |-- empty_array: array (nullable = false)</span>
<span class="go"> |    |-- element: struct (containsNull = true)</span>
<span class="go"> |    |    |-- b: integer (nullable = true)</span>
<span class="go"> |    |    |-- c: array (nullable = true)</span>
<span class="go"> |    |    |    |-- element: string (containsNull = true)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+---+-----------+</span>
<span class="go">|  a|empty_array|</span>
<span class="go">+---+-----------+</span>
<span class="go">|  1|         []|</span>
<span class="go">+---+-----------+</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>spark_frame/functions.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">empty_array</span><span class="p">(</span><span class="n">element_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataType</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create an empty Spark array column of the specified type.</span>
<span class="sd">    This is a workaround to the Spark method `typedLit` not being available in PySpark</span>

<span class="sd">    Args:</span>
<span class="sd">        element_type: The type of the array&#39;s element</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Spark Column representing an empty array.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from pyspark.sql import SparkSession</span>
<span class="sd">        &gt;&gt;&gt; spark = SparkSession.builder.appName(&quot;doctest&quot;).getOrCreate()</span>
<span class="sd">        &gt;&gt;&gt; from pyspark.sql import functions as f</span>
<span class="sd">        &gt;&gt;&gt; df = spark.sql(&#39;&#39;&#39;SELECT 1 as a&#39;&#39;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; res = df.withColumn(&#39;empty_array&#39;, empty_array(&quot;STRUCT&lt;b: int, c: array&lt;string&gt;&gt;&quot;))</span>
<span class="sd">        &gt;&gt;&gt; res.printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- a: integer (nullable = false)</span>
<span class="sd">         |-- empty_array: array (nullable = false)</span>
<span class="sd">         |    |-- element: struct (containsNull = true)</span>
<span class="sd">         |    |    |-- b: integer (nullable = true)</span>
<span class="sd">         |    |    |-- c: array (nullable = true)</span>
<span class="sd">         |    |    |    |-- element: string (containsNull = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; res.show()</span>
<span class="sd">        +---+-----------+</span>
<span class="sd">        |  a|empty_array|</span>
<span class="sd">        +---+-----------+</span>
<span class="sd">        |  1|         []|</span>
<span class="sd">        +---+-----------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">array_except</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">element_type</span><span class="p">)),</span> <span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.functions.generic_struct" class="doc doc-heading">
<code class="highlight language-python"><span class="n">generic_struct</span><span class="p">(</span><span class="o">*</span><span class="n">columns</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_name_alias</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">col_value_alias</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Transform a set of columns into a generic array of struct of type ARRAY<STRUCT\<name: STRING, value: STRING>
(column_name -> column_value)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>*columns</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>One or multiple column names to add to the generic struct</p></td>
          <td>
                <code>()</code>
          </td>
        </tr>
        <tr>
          <td><code>col_name_alias</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Alias of the field containing the column names in the returned struct</p></td>
          <td>
                <code>&#39;name&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>col_value_alias</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Alias of the field containing the column values in the returned struct</p></td>
          <td>
                <code>&#39;value&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.Column" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Column.html#pyspark.sql.Column">Column</a></code>
          </td>
          <td><p>A Spark Column</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;doctest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="gp">... </span><span class="s1">    SELECT</span>
<span class="gp">... </span><span class="s1">      col1 as `pokemon.id`,</span>
<span class="gp">... </span><span class="s1">      col2 as `pokemon.name`,</span>
<span class="gp">... </span><span class="s1">      col3 as `pokemon.types`</span>
<span class="gp">... </span><span class="s1">    FROM VALUES</span>
<span class="gp">... </span><span class="s1">      (4, &#39;Charmander&#39;, ARRAY(NAMED_STRUCT(&#39;type&#39;, &#39;Fire&#39;))),</span>
<span class="gp">... </span><span class="s1">      (5, &#39;Charmeleon&#39;, ARRAY(NAMED_STRUCT(&#39;type&#39;, &#39;Fire&#39;))),</span>
<span class="gp">... </span><span class="s1">      (6, &#39;Charizard&#39;,  ARRAY(NAMED_STRUCT(&#39;type&#39;, &#39;Fire&#39;), NAMED_STRUCT(&#39;type&#39;, &#39;Flying&#39;)))</span>
<span class="gp">... </span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+----------+------------+------------------+</span>
<span class="go">|pokemon.id|pokemon.name|     pokemon.types|</span>
<span class="go">+----------+------------+------------------+</span>
<span class="go">|         4|  Charmander|          [{Fire}]|</span>
<span class="go">|         5|  Charmeleon|          [{Fire}]|</span>
<span class="go">|         6|   Charizard|[{Fire}, {Flying}]|</span>
<span class="go">+----------+------------+------------------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">generic_struct</span><span class="p">(</span><span class="s2">&quot;pokemon.id&quot;</span><span class="p">,</span> <span class="s2">&quot;pokemon.name&quot;</span><span class="p">,</span> <span class="s2">&quot;pokemon.types&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;values&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- values: array (nullable = false)</span>
<span class="go"> |    |-- element: struct (containsNull = false)</span>
<span class="go"> |    |    |-- name: string (nullable = false)</span>
<span class="go"> |    |    |-- value: string (nullable = false)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">+---------------------------------------------------------------------------------+</span>
<span class="go">|values                                                                           |</span>
<span class="go">+---------------------------------------------------------------------------------+</span>
<span class="go">|[{pokemon.id, 4}, {pokemon.name, Charmander}, {pokemon.types, [{Fire}]}]         |</span>
<span class="go">|[{pokemon.id, 5}, {pokemon.name, Charmeleon}, {pokemon.types, [{Fire}]}]         |</span>
<span class="go">|[{pokemon.id, 6}, {pokemon.name, Charizard}, {pokemon.types, [{Fire}, {Flying}]}]|</span>
<span class="go">+---------------------------------------------------------------------------------+</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>spark_frame/functions.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generic_struct</span><span class="p">(</span><span class="o">*</span><span class="n">columns</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_name_alias</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">col_value_alias</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Transform a set of columns into a generic array of struct of type ARRAY&lt;STRUCT&lt;name: STRING, value: STRING&gt;</span>
<span class="sd">    (column_name -&gt; column_value)</span>

<span class="sd">    Args:</span>
<span class="sd">        *columns: One or multiple column names to add to the generic struct</span>
<span class="sd">        col_name_alias: Alias of the field containing the column names in the returned struct</span>
<span class="sd">        col_value_alias: Alias of the field containing the column values in the returned struct</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Spark Column</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from pyspark.sql import SparkSession</span>
<span class="sd">        &gt;&gt;&gt; spark = SparkSession.builder.appName(&quot;doctest&quot;).getOrCreate()</span>
<span class="sd">        &gt;&gt;&gt; df = spark.sql(&#39;&#39;&#39;</span>
<span class="sd">        ...     SELECT</span>
<span class="sd">        ...       col1 as `pokemon.id`,</span>
<span class="sd">        ...       col2 as `pokemon.name`,</span>
<span class="sd">        ...       col3 as `pokemon.types`</span>
<span class="sd">        ...     FROM VALUES</span>
<span class="sd">        ...       (4, &#39;Charmander&#39;, ARRAY(NAMED_STRUCT(&#39;type&#39;, &#39;Fire&#39;))),</span>
<span class="sd">        ...       (5, &#39;Charmeleon&#39;, ARRAY(NAMED_STRUCT(&#39;type&#39;, &#39;Fire&#39;))),</span>
<span class="sd">        ...       (6, &#39;Charizard&#39;,  ARRAY(NAMED_STRUCT(&#39;type&#39;, &#39;Fire&#39;), NAMED_STRUCT(&#39;type&#39;, &#39;Flying&#39;)))</span>
<span class="sd">        ... &#39;&#39;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; df.show()</span>
<span class="sd">        +----------+------------+------------------+</span>
<span class="sd">        |pokemon.id|pokemon.name|     pokemon.types|</span>
<span class="sd">        +----------+------------+------------------+</span>
<span class="sd">        |         4|  Charmander|          [{Fire}]|</span>
<span class="sd">        |         5|  Charmeleon|          [{Fire}]|</span>
<span class="sd">        |         6|   Charizard|[{Fire}, {Flying}]|</span>
<span class="sd">        +----------+------------+------------------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; res = df.select(generic_struct(&quot;pokemon.id&quot;, &quot;pokemon.name&quot;, &quot;pokemon.types&quot;).alias(&#39;values&#39;))</span>
<span class="sd">        &gt;&gt;&gt; res.printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- values: array (nullable = false)</span>
<span class="sd">         |    |-- element: struct (containsNull = false)</span>
<span class="sd">         |    |    |-- name: string (nullable = false)</span>
<span class="sd">         |    |    |-- value: string (nullable = false)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; res.show(10, False)</span>
<span class="sd">        +---------------------------------------------------------------------------------+</span>
<span class="sd">        |values                                                                           |</span>
<span class="sd">        +---------------------------------------------------------------------------------+</span>
<span class="sd">        |[{pokemon.id, 4}, {pokemon.name, Charmander}, {pokemon.types, [{Fire}]}]         |</span>
<span class="sd">        |[{pokemon.id, 5}, {pokemon.name, Charmeleon}, {pokemon.types, [{Fire}]}]         |</span>
<span class="sd">        |[{pokemon.id, 6}, {pokemon.name, Charizard}, {pokemon.types, [{Fire}, {Flying}]}]|</span>
<span class="sd">        +---------------------------------------------------------------------------------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="o">*</span><span class="p">[</span>
            <span class="n">f</span><span class="o">.</span><span class="n">struct</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">col_name_alias</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">StringType</span><span class="p">())</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">col_value_alias</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span>
        <span class="p">]</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.functions.nullable" class="doc doc-heading">
<code class="highlight language-python"><span class="n">nullable</span><span class="p">(</span><span class="n">col</span><span class="p">:</span> <span class="n">Column</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Make a <code>pyspark.sql.Column</code> nullable.
This is especially useful for literal which are always non-nullable by default.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;doctest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">f</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;SELECT 1 as a&#39;&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- a: integer (nullable = false)</span>
<span class="go"> |-- b: string (nullable = false)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">nullable</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)))</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">nullable</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- a: integer (nullable = true)</span>
<span class="go"> |-- b: string (nullable = true)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>spark_frame/functions.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">nullable</span><span class="p">(</span><span class="n">col</span><span class="p">:</span> <span class="n">Column</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Make a `pyspark.sql.Column` nullable.</span>
<span class="sd">    This is especially useful for literal which are always non-nullable by default.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from pyspark.sql import SparkSession</span>
<span class="sd">        &gt;&gt;&gt; spark = SparkSession.builder.appName(&quot;doctest&quot;).getOrCreate()</span>
<span class="sd">        &gt;&gt;&gt; from pyspark.sql import functions as f</span>
<span class="sd">        &gt;&gt;&gt; df = spark.sql(&#39;&#39;&#39;SELECT 1 as a&#39;&#39;&#39;).withColumn(&quot;b&quot;, f.lit(&quot;2&quot;))</span>
<span class="sd">        &gt;&gt;&gt; df.printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- a: integer (nullable = false)</span>
<span class="sd">         |-- b: string (nullable = false)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; res = df.withColumn(&#39;a&#39;, nullable(f.col(&#39;a&#39;))).withColumn(&#39;b&#39;, nullable(f.col(&#39;b&#39;)))</span>
<span class="sd">        &gt;&gt;&gt; res.printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- a: integer (nullable = true)</span>
<span class="sd">         |-- b: string (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="o">~</span><span class="n">col</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">col</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />
<h2 id="spark_framegraph">spark_frame.graph</h2>
<p>This module contains implementations of graph algorithms and related methods.</p>
<hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.graph_impl.ascending_forest_traversal.ascending_forest_traversal" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ascending_forest_traversal</span><span class="p">(</span><span class="n">input_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">keep_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Given a DataFrame representing a labeled forest with columns <code>id</code>, <code>parent_id</code> and other label columns,
performs a graph traversal that will return a DataFrame with the same schema that gives for each node
the labels of it's furthest ancestor.</p>
<p>In the input DataFrame, a node is considered to have no parent if its parent_id is null or equal to its node_id.
In the output DataFrame, a node that has no parent will have its parent_id equal to its node_id.
Cycle protection: If the graph contains any cycle, the nodes in that cycle will have a NULL parent_id.</p>
<p>It has a security against dependency cycles, but no security preventing
a combinatorial explosion if some nodes have more than one parent.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_df</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>A Spark DataFrame</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>node_id</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of the column that represent the node's ids</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>parent_id</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of the column that represent the parent node's ids</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>keep_labels</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If set to true, add two structs column called "node" and "furthest_ancestor" containing
the content of the row from the input DataFrame for the corresponding nodes and their furthest ancestor</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>A DataFrame with two columns named according to <code>node_id</code> and <code>parent_id</code> that gives for each node</p></td>
        </tr>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>the id of it's furthest ancestor (in the <code>parent_id</code> column).</p></td>
        </tr>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>If the option <code>keep_labels</code> is used, two extra columns of type STRUCT are a added to the output DataFrame,</p></td>
        </tr>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>they represent the content of the rows in the input DataFrame corresponding to the node and its furthest</p></td>
        </tr>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>ancestor, respectively.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;doctest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</code></pre></div>
    <p>Given a DataFrame with pokemon attributes and evolution links</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">input_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="gp">... </span><span class="s1">    SELECT</span>
<span class="gp">... </span><span class="s1">      col1 as `pokemon.id`,</span>
<span class="gp">... </span><span class="s1">      col2 as `pokemon.evolve_to_id`,</span>
<span class="gp">... </span><span class="s1">      col3 as `pokemon.name`,</span>
<span class="gp">... </span><span class="s1">      col4 as `pokemon.types`</span>
<span class="gp">... </span><span class="s1">    FROM VALUES</span>
<span class="gp">... </span><span class="s1">      (4, 5, &#39;Charmander&#39;, ARRAY(&#39;Fire&#39;)),</span>
<span class="gp">... </span><span class="s1">      (5, 6, &#39;Charmeleon&#39;, ARRAY(&#39;Fire&#39;)),</span>
<span class="gp">... </span><span class="s1">      (6, NULL, &#39;Charizard&#39;, ARRAY(&#39;Fire&#39;, &#39;Flying&#39;))</span>
<span class="gp">... </span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+----------+--------------------+------------+--------------+</span>
<span class="go">|pokemon.id|pokemon.evolve_to_id|pokemon.name| pokemon.types|</span>
<span class="go">+----------+--------------------+------------+--------------+</span>
<span class="go">|         4|                   5|  Charmander|        [Fire]|</span>
<span class="go">|         5|                   6|  Charmeleon|        [Fire]|</span>
<span class="go">|         6|                null|   Charizard|[Fire, Flying]|</span>
<span class="go">+----------+--------------------+------------+--------------+</span>
</code></pre></div>
    <p>We compute a DataFrame that for each pokemon.id gives the attributes of its highest level of evolution</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ascending_forest_traversal</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="s2">&quot;pokemon.id&quot;</span><span class="p">,</span> <span class="s2">&quot;pokemon.evolve_to_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;`pokemon.id`&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+----------+--------------------+</span>
<span class="go">|pokemon.id|pokemon.evolve_to_id|</span>
<span class="go">+----------+--------------------+</span>
<span class="go">|         4|                   6|</span>
<span class="go">|         5|                   6|</span>
<span class="go">|         6|                   6|</span>
<span class="go">+----------+--------------------+</span>
</code></pre></div>
    <p>With the <code>keep_label</code> option extra joins are performed at the end of the algorithm to add two struct columns
containing the corresponding row for the original node and the furthest ancestor.</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ascending_forest_traversal</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="s2">&quot;pokemon.id&quot;</span><span class="p">,</span> <span class="s2">&quot;pokemon.evolve_to_id&quot;</span><span class="p">,</span> <span class="n">keep_labels</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span>    <span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;`pokemon.id`&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">+----------+--------------------+------------------------------------+------------------------------------+</span>
<span class="go">|pokemon.id|pokemon.evolve_to_id|node                                |furthest_ancestor                   |</span>
<span class="go">+----------+--------------------+------------------------------------+------------------------------------+</span>
<span class="go">|4         |6                   |{4, 5, Charmander, [Fire]}          |{6, null, Charizard, [Fire, Flying]}|</span>
<span class="go">|5         |6                   |{5, 6, Charmeleon, [Fire]}          |{6, null, Charizard, [Fire, Flying]}|</span>
<span class="go">|6         |6                   |{6, null, Charizard, [Fire, Flying]}|{6, null, Charizard, [Fire, Flying]}|</span>
<span class="go">+----------+--------------------+------------------------------------+------------------------------------+</span>
</code></pre></div>
    <p><em>Cycle Protection:</em> to prevent the algorithm from looping indefinitely, cycles are detected, and the nodes
that are part of cycles will end up with a NULL value as their furthest ancestor</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">input_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="gp">... </span><span class="s1">    SELECT</span>
<span class="gp">... </span><span class="s1">      col1 as `node_id`,</span>
<span class="gp">... </span><span class="s1">      col2 as `parent_id`</span>
<span class="gp">... </span><span class="s1">    FROM VALUES (1, 2), (2, 3), (3, 1)</span>
<span class="gp">... </span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+-------+---------+</span>
<span class="go">|node_id|parent_id|</span>
<span class="go">+-------+---------+</span>
<span class="go">|      1|        2|</span>
<span class="go">|      2|        3|</span>
<span class="go">|      3|        1|</span>
<span class="go">+-------+---------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ascending_forest_traversal</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="s2">&quot;parent_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+-------+---------+</span>
<span class="go">|node_id|parent_id|</span>
<span class="go">+-------+---------+</span>
<span class="go">|      1|     null|</span>
<span class="go">|      2|     null|</span>
<span class="go">|      3|     null|</span>
<span class="go">+-------+---------+</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>spark_frame/graph_impl/ascending_forest_traversal.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ascending_forest_traversal</span><span class="p">(</span>
    <span class="n">input_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">keep_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Given a DataFrame representing a labeled forest with columns `id`, `parent_id` and other label columns,</span>
<span class="sd">    performs a graph traversal that will return a DataFrame with the same schema that gives for each node</span>
<span class="sd">    the labels of it&#39;s furthest ancestor.</span>

<span class="sd">    In the input DataFrame, a node is considered to have no parent if its parent_id is null or equal to its node_id.</span>
<span class="sd">    In the output DataFrame, a node that has no parent will have its parent_id equal to its node_id.</span>
<span class="sd">    Cycle protection: If the graph contains any cycle, the nodes in that cycle will have a NULL parent_id.</span>

<span class="sd">    It has a security against dependency cycles, but no security preventing</span>
<span class="sd">    a combinatorial explosion if some nodes have more than one parent.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_df: A Spark DataFrame</span>
<span class="sd">        node_id: Name of the column that represent the node&#39;s ids</span>
<span class="sd">        parent_id: Name of the column that represent the parent node&#39;s ids</span>
<span class="sd">        keep_labels: If set to true, add two structs column called &quot;node&quot; and &quot;furthest_ancestor&quot; containing</span>
<span class="sd">            the content of the row from the input DataFrame for the corresponding nodes and their furthest ancestor</span>

<span class="sd">    Returns:</span>
<span class="sd">        A DataFrame with two columns named according to `node_id` and `parent_id` that gives for each node</span>
<span class="sd">        the id of it&#39;s furthest ancestor (in the `parent_id` column).</span>
<span class="sd">        If the option `keep_labels` is used, two extra columns of type STRUCT are a added to the output DataFrame,</span>
<span class="sd">        they represent the content of the rows in the input DataFrame corresponding to the node and its furthest</span>
<span class="sd">        ancestor, respectively.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from pyspark.sql import SparkSession</span>
<span class="sd">        &gt;&gt;&gt; spark = SparkSession.builder.appName(&quot;doctest&quot;).getOrCreate()</span>

<span class="sd">        Given a DataFrame with pokemon attributes and evolution links</span>

<span class="sd">        &gt;&gt;&gt; input_df = spark.sql(&#39;&#39;&#39;</span>
<span class="sd">        ...     SELECT</span>
<span class="sd">        ...       col1 as `pokemon.id`,</span>
<span class="sd">        ...       col2 as `pokemon.evolve_to_id`,</span>
<span class="sd">        ...       col3 as `pokemon.name`,</span>
<span class="sd">        ...       col4 as `pokemon.types`</span>
<span class="sd">        ...     FROM VALUES</span>
<span class="sd">        ...       (4, 5, &#39;Charmander&#39;, ARRAY(&#39;Fire&#39;)),</span>
<span class="sd">        ...       (5, 6, &#39;Charmeleon&#39;, ARRAY(&#39;Fire&#39;)),</span>
<span class="sd">        ...       (6, NULL, &#39;Charizard&#39;, ARRAY(&#39;Fire&#39;, &#39;Flying&#39;))</span>
<span class="sd">        ... &#39;&#39;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; input_df.show()</span>
<span class="sd">        +----------+--------------------+------------+--------------+</span>
<span class="sd">        |pokemon.id|pokemon.evolve_to_id|pokemon.name| pokemon.types|</span>
<span class="sd">        +----------+--------------------+------------+--------------+</span>
<span class="sd">        |         4|                   5|  Charmander|        [Fire]|</span>
<span class="sd">        |         5|                   6|  Charmeleon|        [Fire]|</span>
<span class="sd">        |         6|                null|   Charizard|[Fire, Flying]|</span>
<span class="sd">        +----------+--------------------+------------+--------------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>

<span class="sd">        We compute a DataFrame that for each pokemon.id gives the attributes of its highest level of evolution</span>

<span class="sd">        &gt;&gt;&gt; ascending_forest_traversal(input_df, &quot;pokemon.id&quot;, &quot;pokemon.evolve_to_id&quot;).orderBy(&quot;`pokemon.id`&quot;).show()</span>
<span class="sd">        +----------+--------------------+</span>
<span class="sd">        |pokemon.id|pokemon.evolve_to_id|</span>
<span class="sd">        +----------+--------------------+</span>
<span class="sd">        |         4|                   6|</span>
<span class="sd">        |         5|                   6|</span>
<span class="sd">        |         6|                   6|</span>
<span class="sd">        +----------+--------------------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>

<span class="sd">        With the `keep_label` option extra joins are performed at the end of the algorithm to add two struct columns</span>
<span class="sd">        containing the corresponding row for the original node and the furthest ancestor.</span>

<span class="sd">        &gt;&gt;&gt; ascending_forest_traversal(input_df, &quot;pokemon.id&quot;, &quot;pokemon.evolve_to_id&quot;, keep_labels=True</span>
<span class="sd">        ...     ).orderBy(&quot;`pokemon.id`&quot;).show(10, False)</span>
<span class="sd">        +----------+--------------------+------------------------------------+------------------------------------+</span>
<span class="sd">        |pokemon.id|pokemon.evolve_to_id|node                                |furthest_ancestor                   |</span>
<span class="sd">        +----------+--------------------+------------------------------------+------------------------------------+</span>
<span class="sd">        |4         |6                   |{4, 5, Charmander, [Fire]}          |{6, null, Charizard, [Fire, Flying]}|</span>
<span class="sd">        |5         |6                   |{5, 6, Charmeleon, [Fire]}          |{6, null, Charizard, [Fire, Flying]}|</span>
<span class="sd">        |6         |6                   |{6, null, Charizard, [Fire, Flying]}|{6, null, Charizard, [Fire, Flying]}|</span>
<span class="sd">        +----------+--------------------+------------------------------------+------------------------------------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>

<span class="sd">        *Cycle Protection:* to prevent the algorithm from looping indefinitely, cycles are detected, and the nodes</span>
<span class="sd">        that are part of cycles will end up with a NULL value as their furthest ancestor</span>

<span class="sd">        &gt;&gt;&gt; input_df = spark.sql(&#39;&#39;&#39;</span>
<span class="sd">        ...     SELECT</span>
<span class="sd">        ...       col1 as `node_id`,</span>
<span class="sd">        ...       col2 as `parent_id`</span>
<span class="sd">        ...     FROM VALUES (1, 2), (2, 3), (3, 1)</span>
<span class="sd">        ... &#39;&#39;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; input_df.show()</span>
<span class="sd">        +-------+---------+</span>
<span class="sd">        |node_id|parent_id|</span>
<span class="sd">        +-------+---------+</span>
<span class="sd">        |      1|        2|</span>
<span class="sd">        |      2|        3|</span>
<span class="sd">        |      3|        1|</span>
<span class="sd">        +-------+---------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; ascending_forest_traversal(input_df, &quot;node_id&quot;, &quot;parent_id&quot;).orderBy(&quot;node_id&quot;).show()</span>
<span class="sd">        +-------+---------+</span>
<span class="sd">        |node_id|parent_id|</span>
<span class="sd">        +-------+---------+</span>
<span class="sd">        |      1|     null|</span>
<span class="sd">        |      2|     null|</span>
<span class="sd">        |      3|     null|</span>
<span class="sd">        +-------+---------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">assert_true</span><span class="p">(</span>
        <span class="n">node_id</span> <span class="ow">in</span> <span class="n">input_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;Could not find column </span><span class="si">%s</span><span class="s2"> in Dataframe&#39;s columns: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">input_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">assert_true</span><span class="p">(</span>
        <span class="n">parent_id</span> <span class="ow">in</span> <span class="n">input_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
        <span class="s2">&quot;Could not find column </span><span class="si">%s</span><span class="s2"> in Dataframe&#39;s columns: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parent_id</span><span class="p">,</span> <span class="n">input_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">node_id_col_name</span> <span class="o">=</span> <span class="s2">&quot;node_id&quot;</span>
    <span class="n">parent_id_col_name</span> <span class="o">=</span> <span class="s2">&quot;parent_id&quot;</span>
    <span class="n">status_col_name</span> <span class="o">=</span> <span class="s2">&quot;status&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">input_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">node_id</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">node_id_col_name</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">parent_id</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">parent_id_col_name</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">res_df</span> <span class="o">=</span> <span class="n">_ascending_forest_traversal</span><span class="p">(</span>
        <span class="n">df</span><span class="p">,</span> <span class="n">node_id_col_name</span><span class="o">=</span><span class="n">node_id_col_name</span><span class="p">,</span> <span class="n">parent_id_col_name</span><span class="o">=</span><span class="n">parent_id_col_name</span><span class="p">,</span> <span class="n">status_col_name</span><span class="o">=</span><span class="n">status_col_name</span>
    <span class="p">)</span>
    <span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">node_id_col_name</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">node_id</span><span class="p">),</span>
        <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">parent_id_col_name</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">parent_id</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">keep_labels</span><span class="p">:</span>
        <span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">node_id</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">res_df</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
            <span class="n">f</span><span class="o">.</span><span class="n">struct</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">input_df</span><span class="p">[</span><span class="n">quote</span><span class="p">(</span><span class="n">col</span><span class="p">)]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">input_df</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;node&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">res_df</span><span class="p">[</span><span class="n">quote</span><span class="p">(</span><span class="n">parent_id</span><span class="p">)]</span> <span class="o">==</span> <span class="n">input_df</span><span class="p">[</span><span class="n">quote</span><span class="p">(</span><span class="n">node_id</span><span class="p">)])</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">res_df</span><span class="p">[</span><span class="n">quote</span><span class="p">(</span><span class="n">node_id</span><span class="p">)],</span>
            <span class="n">res_df</span><span class="p">[</span><span class="n">quote</span><span class="p">(</span><span class="n">parent_id</span><span class="p">)],</span>
            <span class="n">res_df</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">],</span>
            <span class="n">f</span><span class="o">.</span><span class="n">struct</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">input_df</span><span class="p">[</span><span class="n">quote</span><span class="p">(</span><span class="n">col</span><span class="p">)]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">input_df</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;furthest_ancestor&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">res_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />
<h2 id="spark_frametransformations">spark_frame.transformations</h2>
<p>Unlike those in <a href="#spark_framefunctions">spark_frame.functions</a>, the methods in this module all take at least one
<a href="pyspark.sql.DataFrame">DataFrame</a> as argument and return a new transformed DataFrame.
These methods generally offer <em>higher order</em> transformation that requires to inspect the schema or event the content
of the input DataFrame(s) before generating the next transformation. Those are typically generic operations 
that <em>cannot</em> be implemented with one single SQL query.</p>
<hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.transformations_impl.flatten.flatten" class="doc doc-heading">
<code class="highlight language-python"><span class="n">flatten</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Flatten all the struct columns of a Spark <a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a>.
Nested fields names will be joined together using the specified separator</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>A Spark DataFrame</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>separator</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>A string used to separate the structs names from their elements.
       It might be useful to change the separator when some DataFrame's column names already contain dots</p></td>
          <td>
                <code>&#39;.&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>A flattened DataFrame</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;doctest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<span class="gp">... </span>        <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}})],</span>
<span class="gp">... </span>        <span class="s2">&quot;id INT, s STRUCT&lt;a:INT, b:STRUCT&lt;c:INT, d:INT&gt;&gt;&quot;</span>
<span class="gp">... </span>     <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- s: struct (nullable = true)</span>
<span class="go"> |    |-- a: integer (nullable = true)</span>
<span class="go"> |    |-- b: struct (nullable = true)</span>
<span class="go"> |    |    |-- c: integer (nullable = true)</span>
<span class="go"> |    |    |-- d: integer (nullable = true)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">flatten</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- s.a: integer (nullable = true)</span>
<span class="go"> |-- s.b.c: integer (nullable = true)</span>
<span class="go"> |-- s.b.d: integer (nullable = true)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<span class="gp">... </span>        <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;a.a1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b.b1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;c.c1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;d.d1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}})],</span>
<span class="gp">... </span>        <span class="s2">&quot;id INT, `s.s1` STRUCT&lt;`a.a1`:INT, `b.b1`:STRUCT&lt;`c.c1`:INT, `d.d1`:INT&gt;&gt;&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- s.s1: struct (nullable = true)</span>
<span class="go"> |    |-- a.a1: integer (nullable = true)</span>
<span class="go"> |    |-- b.b1: struct (nullable = true)</span>
<span class="go"> |    |    |-- c.c1: integer (nullable = true)</span>
<span class="go"> |    |    |-- d.d1: integer (nullable = true)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">flatten</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- s.s1?a.a1: integer (nullable = true)</span>
<span class="go"> |-- s.s1?b.b1?c.c1: integer (nullable = true)</span>
<span class="go"> |-- s.s1?b.b1?d.d1: integer (nullable = true)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>spark_frame/transformations_impl/flatten.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Flatten all the struct columns of a Spark [DataFrame][pyspark.sql.DataFrame].</span>
<span class="sd">    Nested fields names will be joined together using the specified separator</span>

<span class="sd">    Args:</span>
<span class="sd">        df: A Spark DataFrame</span>
<span class="sd">        separator: A string used to separate the structs names from their elements.</span>
<span class="sd">                   It might be useful to change the separator when some DataFrame&#39;s column names already contain dots</span>

<span class="sd">    Returns:</span>
<span class="sd">        A flattened DataFrame</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from pyspark.sql import SparkSession</span>
<span class="sd">        &gt;&gt;&gt; spark = SparkSession.builder.appName(&quot;doctest&quot;).getOrCreate()</span>
<span class="sd">        &gt;&gt;&gt; df = spark.createDataFrame(</span>
<span class="sd">        ...         [(1, {&quot;a&quot;: 1, &quot;b&quot;: {&quot;c&quot;: 1, &quot;d&quot;: 1}})],</span>
<span class="sd">        ...         &quot;id INT, s STRUCT&lt;a:INT, b:STRUCT&lt;c:INT, d:INT&gt;&gt;&quot;</span>
<span class="sd">        ...      )</span>
<span class="sd">        &gt;&gt;&gt; df.printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- s: struct (nullable = true)</span>
<span class="sd">         |    |-- a: integer (nullable = true)</span>
<span class="sd">         |    |-- b: struct (nullable = true)</span>
<span class="sd">         |    |    |-- c: integer (nullable = true)</span>
<span class="sd">         |    |    |-- d: integer (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; flatten(df).printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- s.a: integer (nullable = true)</span>
<span class="sd">         |-- s.b.c: integer (nullable = true)</span>
<span class="sd">         |-- s.b.d: integer (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; df = spark.createDataFrame(</span>
<span class="sd">        ...         [(1, {&quot;a.a1&quot;: 1, &quot;b.b1&quot;: {&quot;c.c1&quot;: 1, &quot;d.d1&quot;: 1}})],</span>
<span class="sd">        ...         &quot;id INT, `s.s1` STRUCT&lt;`a.a1`:INT, `b.b1`:STRUCT&lt;`c.c1`:INT, `d.d1`:INT&gt;&gt;&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; df.printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- s.s1: struct (nullable = true)</span>
<span class="sd">         |    |-- a.a1: integer (nullable = true)</span>
<span class="sd">         |    |-- b.b1: struct (nullable = true)</span>
<span class="sd">         |    |    |-- c.c1: integer (nullable = true)</span>
<span class="sd">         |    |    |-- d.d1: integer (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; flatten(df, &quot;?&quot;).printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- s.s1?a.a1: integer (nullable = true)</span>
<span class="sd">         |-- s.s1?b.b1?c.c1: integer (nullable = true)</span>
<span class="sd">         |-- s.s1?b.b1?d.d1: integer (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The idea is to recursively write a &quot;SELECT s.b.c as `s.b.c`&quot; for each nested column.</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">expand_struct</span><span class="p">(</span><span class="n">struct</span><span class="p">:</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">col_stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">struct</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">dataType</span><span class="p">)</span> <span class="o">==</span> <span class="n">StructType</span><span class="p">:</span>
                <span class="n">struct_field</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">StructType</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">dataType</span><span class="p">)</span>
                <span class="n">expand_struct</span><span class="p">(</span><span class="n">struct_field</span><span class="p">,</span> <span class="n">col_stack</span> <span class="o">+</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">column</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">quote_columns</span><span class="p">(</span><span class="n">col_stack</span> <span class="o">+</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">])))</span>
                <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">col_stack</span> <span class="o">+</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">])))</span>

    <span class="n">expand_struct</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="n">col_stack</span><span class="o">=</span><span class="p">[])</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.transformations_impl.parse_json_columns.parse_json_columns" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parse_json_columns</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Transform the specified columns containing json strings in the given DataFrame into structs containing
the equivalent parsed information.</p>
<p>This method is similar to Spark's <code>from_json</code> function, with one main difference: <code>from_json</code> requires the user
to pass the expected json schema, while this method performs a first pass on the DataFrame to detect automatically
the json schema of each column.</p>
<p>By default, the output columns will have the same name as the input columns, but if you want to keep the input
columns you can pass a dict(input_col_name, output_col_name) to specify different output column names.</p>
<p>Please be aware that automatic schema detection is not very robust, and while this method can be quite helpful
for quick prototyping and data exploration, it is recommended to use a fixed schema and make sure the schema
of the input json data is properly enforce, or at the very least use schema have a drift detection mechanism.</p>
<p>WARNING : when you use this method on a column that is inside a struct (e.g. column "a.b.c"),
instead of replacing that column it will create a new column outside the struct (e.g. "<code>a.b.c</code>") (See Example 2).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>A Spark DataFrame</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>columns</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, <span title="typing.List">List</span>[str], <span title="typing.Dict">Dict</span>[str, str]]</code>
          </td>
          <td><p>A column name, list of column names, or dict(column_name, parsed_column_name)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>A new DataFrame</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <p><strong>Example 1 :</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;doctest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;[{&quot;a&quot;: 1}, {&quot;a&quot;: 2}]&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;[{&quot;a&quot;: 2}, {&quot;a&quot;: 4}]&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">],</span> <span class="s2">&quot;id INT, json1 STRING&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+---+--------------------+</span>
<span class="go">| id|               json1|</span>
<span class="go">+---+--------------------+</span>
<span class="go">|  1|[{&quot;a&quot;: 1}, {&quot;a&quot;: 2}]|</span>
<span class="go">|  1|[{&quot;a&quot;: 2}, {&quot;a&quot;: 4}]|</span>
<span class="go">|  2|                null|</span>
<span class="go">+---+--------------------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- json1: string (nullable = true)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">parse_json_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;json1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- json1: array (nullable = true)</span>
<span class="go"> |    |-- element: struct (containsNull = true)</span>
<span class="go"> |    |    |-- a: long (nullable = true)</span>
</code></pre></div>
    <p><strong>Example 2 : different output column name :</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">parse_json_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;json1&#39;</span><span class="p">:</span> <span class="s1">&#39;parsed_json1&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- json1: string (nullable = true)</span>
<span class="go"> |-- parsed_json1: array (nullable = true)</span>
<span class="go"> |    |-- element: struct (containsNull = true)</span>
<span class="go"> |    |    |-- a: long (nullable = true)</span>
</code></pre></div>
    <p><strong>Example 3 : json inside a struct :</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;json1&#39;</span><span class="p">:</span> <span class="s1">&#39;[{&quot;a&quot;: 1}, {&quot;a&quot;: 2}]&#39;</span><span class="p">}),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;json1&#39;</span><span class="p">:</span> <span class="s1">&#39;[{&quot;a&quot;: 2}, {&quot;a&quot;: 4}]&#39;</span><span class="p">}),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">],</span> <span class="s2">&quot;id INT, struct STRUCT&lt;json1: STRING&gt;&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">+---+----------------------+</span>
<span class="go">|id |struct                |</span>
<span class="go">+---+----------------------+</span>
<span class="go">|1  |{[{&quot;a&quot;: 1}, {&quot;a&quot;: 2}]}|</span>
<span class="go">|1  |{[{&quot;a&quot;: 2}, {&quot;a&quot;: 4}]}|</span>
<span class="go">|2  |null                  |</span>
<span class="go">+---+----------------------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- struct: struct (nullable = true)</span>
<span class="go"> |    |-- json1: string (nullable = true)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">parse_json_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;struct.json1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- struct: struct (nullable = true)</span>
<span class="go"> |    |-- json1: string (nullable = true)</span>
<span class="go"> |-- struct.json1: array (nullable = true)</span>
<span class="go"> |    |-- element: struct (containsNull = true)</span>
<span class="go"> |    |    |-- a: long (nullable = true)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">+---+----------------------+------------+</span>
<span class="go">|id |struct                |struct.json1|</span>
<span class="go">+---+----------------------+------------+</span>
<span class="go">|1  |{[{&quot;a&quot;: 1}, {&quot;a&quot;: 2}]}|[{1}, {2}]  |</span>
<span class="go">|1  |{[{&quot;a&quot;: 2}, {&quot;a&quot;: 4}]}|[{2}, {4}]  |</span>
<span class="go">|2  |null                  |null        |</span>
<span class="go">+---+----------------------+------------+</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>spark_frame/transformations_impl/parse_json_columns.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_json_columns</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Transform the specified columns containing json strings in the given DataFrame into structs containing</span>
<span class="sd">    the equivalent parsed information.</span>

<span class="sd">    This method is similar to Spark&#39;s `from_json` function, with one main difference: `from_json` requires the user</span>
<span class="sd">    to pass the expected json schema, while this method performs a first pass on the DataFrame to detect automatically</span>
<span class="sd">    the json schema of each column.</span>

<span class="sd">    By default, the output columns will have the same name as the input columns, but if you want to keep the input</span>
<span class="sd">    columns you can pass a dict(input_col_name, output_col_name) to specify different output column names.</span>

<span class="sd">    Please be aware that automatic schema detection is not very robust, and while this method can be quite helpful</span>
<span class="sd">    for quick prototyping and data exploration, it is recommended to use a fixed schema and make sure the schema</span>
<span class="sd">    of the input json data is properly enforce, or at the very least use schema have a drift detection mechanism.</span>

<span class="sd">    WARNING : when you use this method on a column that is inside a struct (e.g. column &quot;a.b.c&quot;),</span>
<span class="sd">    instead of replacing that column it will create a new column outside the struct (e.g. &quot;`a.b.c`&quot;) (See Example 2).</span>

<span class="sd">    Args:</span>
<span class="sd">        df: A Spark DataFrame</span>
<span class="sd">        columns: A column name, list of column names, or dict(column_name, parsed_column_name)</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new DataFrame</span>

<span class="sd">    Examples:</span>

<span class="sd">        **Example 1 :**</span>
<span class="sd">        &gt;&gt;&gt; from pyspark.sql import SparkSession</span>
<span class="sd">        &gt;&gt;&gt; spark = SparkSession.builder.appName(&quot;doctest&quot;).getOrCreate()</span>
<span class="sd">        &gt;&gt;&gt; df = spark.createDataFrame([</span>
<span class="sd">        ...         (1, &#39;[{&quot;a&quot;: 1}, {&quot;a&quot;: 2}]&#39;),</span>
<span class="sd">        ...         (1, &#39;[{&quot;a&quot;: 2}, {&quot;a&quot;: 4}]&#39;),</span>
<span class="sd">        ...         (2, None)</span>
<span class="sd">        ...     ], &quot;id INT, json1 STRING&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; df.show()</span>
<span class="sd">        +---+--------------------+</span>
<span class="sd">        | id|               json1|</span>
<span class="sd">        +---+--------------------+</span>
<span class="sd">        |  1|[{&quot;a&quot;: 1}, {&quot;a&quot;: 2}]|</span>
<span class="sd">        |  1|[{&quot;a&quot;: 2}, {&quot;a&quot;: 4}]|</span>
<span class="sd">        |  2|                null|</span>
<span class="sd">        +---+--------------------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; df.printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- json1: string (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; parse_json_columns(df, &#39;json1&#39;).printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- json1: array (nullable = true)</span>
<span class="sd">         |    |-- element: struct (containsNull = true)</span>
<span class="sd">         |    |    |-- a: long (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>

<span class="sd">        **Example 2 : different output column name :**</span>
<span class="sd">        &gt;&gt;&gt; parse_json_columns(df, {&#39;json1&#39;: &#39;parsed_json1&#39;}).printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- json1: string (nullable = true)</span>
<span class="sd">         |-- parsed_json1: array (nullable = true)</span>
<span class="sd">         |    |-- element: struct (containsNull = true)</span>
<span class="sd">         |    |    |-- a: long (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>

<span class="sd">        **Example 3 : json inside a struct :**</span>
<span class="sd">        &gt;&gt;&gt; df = spark.createDataFrame([</span>
<span class="sd">        ...         (1, {&#39;json1&#39;: &#39;[{&quot;a&quot;: 1}, {&quot;a&quot;: 2}]&#39;}),</span>
<span class="sd">        ...         (1, {&#39;json1&#39;: &#39;[{&quot;a&quot;: 2}, {&quot;a&quot;: 4}]&#39;}),</span>
<span class="sd">        ...         (2, None)</span>
<span class="sd">        ...     ], &quot;id INT, struct STRUCT&lt;json1: STRING&gt;&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; df.show(10, False)</span>
<span class="sd">        +---+----------------------+</span>
<span class="sd">        |id |struct                |</span>
<span class="sd">        +---+----------------------+</span>
<span class="sd">        |1  |{[{&quot;a&quot;: 1}, {&quot;a&quot;: 2}]}|</span>
<span class="sd">        |1  |{[{&quot;a&quot;: 2}, {&quot;a&quot;: 4}]}|</span>
<span class="sd">        |2  |null                  |</span>
<span class="sd">        +---+----------------------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; df.printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- struct: struct (nullable = true)</span>
<span class="sd">         |    |-- json1: string (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; res = parse_json_columns(df, &#39;struct.json1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; res.printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- struct: struct (nullable = true)</span>
<span class="sd">         |    |-- json1: string (nullable = true)</span>
<span class="sd">         |-- struct.json1: array (nullable = true)</span>
<span class="sd">         |    |-- element: struct (containsNull = true)</span>
<span class="sd">         |    |    |-- a: long (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; res.show(10, False)</span>
<span class="sd">        +---+----------------------+------------+</span>
<span class="sd">        |id |struct                |struct.json1|</span>
<span class="sd">        +---+----------------------+------------+</span>
<span class="sd">        |1  |{[{&quot;a&quot;: 1}, {&quot;a&quot;: 2}]}|[{1}, {2}]  |</span>
<span class="sd">        |1  |{[{&quot;a&quot;: 2}, {&quot;a&quot;: 4}]}|[{2}, {4}]  |</span>
<span class="sd">        |2  |null                  |null        |</span>
<span class="sd">        +---+----------------------+------------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">}</span>

    <span class="n">wrapped_df</span> <span class="o">=</span> <span class="n">__wrap_json_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
    <span class="n">schema_per_col</span> <span class="o">=</span> <span class="n">__infer_schema_per_column</span><span class="p">(</span><span class="n">wrapped_df</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">__parse_json_columns</span><span class="p">(</span><span class="n">wrapped_df</span><span class="p">,</span> <span class="n">schema_per_col</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.transformations_impl.unflatten.unflatten" class="doc doc-heading">
<code class="highlight language-python"><span class="n">unflatten</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Reverse of the flatten operation
Nested fields names will be separated from each other using the specified separator</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>A Spark DataFrame</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>separator</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>A string used to separate the structs names from their elements.
       It might be useful to change the separator when some DataFrame's column names already contain dots</p></td>
          <td>
                <code>&#39;.&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>A flattened DataFrame</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;doctest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="s2">&quot;id INT, `s.a` INT, `s.b.c` INT, `s.b.d` INT&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- s.a: integer (nullable = true)</span>
<span class="go"> |-- s.b.c: integer (nullable = true)</span>
<span class="go"> |-- s.b.d: integer (nullable = true)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">unflatten</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- s: struct (nullable = true)</span>
<span class="go"> |    |-- a: integer (nullable = true)</span>
<span class="go"> |    |-- b: struct (nullable = true)</span>
<span class="go"> |    |    |-- c: integer (nullable = true)</span>
<span class="go"> |    |    |-- d: integer (nullable = true)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="s2">&quot;id INT, `s.s1?a.a1` INT, `s.s1?b.b1` INT&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- s.s1?a.a1: integer (nullable = true)</span>
<span class="go"> |-- s.s1?b.b1: integer (nullable = true)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">unflatten</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- s.s1: struct (nullable = true)</span>
<span class="go"> |    |-- a.a1: integer (nullable = true)</span>
<span class="go"> |    |-- b.b1: integer (nullable = true)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>spark_frame/transformations_impl/unflatten.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unflatten</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Reverse of the flatten operation</span>
<span class="sd">    Nested fields names will be separated from each other using the specified separator</span>

<span class="sd">    Args:</span>
<span class="sd">        df: A Spark DataFrame</span>
<span class="sd">        separator: A string used to separate the structs names from their elements.</span>
<span class="sd">                   It might be useful to change the separator when some DataFrame&#39;s column names already contain dots</span>

<span class="sd">    Returns:</span>
<span class="sd">        A flattened DataFrame</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from pyspark.sql import SparkSession</span>
<span class="sd">        &gt;&gt;&gt; spark = SparkSession.builder.appName(&quot;doctest&quot;).getOrCreate()</span>
<span class="sd">        &gt;&gt;&gt; df = spark.createDataFrame([(1, 1, 1, 1)], &quot;id INT, `s.a` INT, `s.b.c` INT, `s.b.d` INT&quot;)</span>
<span class="sd">        &gt;&gt;&gt; df.printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- s.a: integer (nullable = true)</span>
<span class="sd">         |-- s.b.c: integer (nullable = true)</span>
<span class="sd">         |-- s.b.d: integer (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; unflatten(df).printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- s: struct (nullable = true)</span>
<span class="sd">         |    |-- a: integer (nullable = true)</span>
<span class="sd">         |    |-- b: struct (nullable = true)</span>
<span class="sd">         |    |    |-- c: integer (nullable = true)</span>
<span class="sd">         |    |    |-- d: integer (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; df = spark.createDataFrame([(1, 1, 1)], &quot;id INT, `s.s1?a.a1` INT, `s.s1?b.b1` INT&quot;)</span>
<span class="sd">        &gt;&gt;&gt; df.printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- s.s1?a.a1: integer (nullable = true)</span>
<span class="sd">         |-- s.s1?b.b1: integer (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; unflatten(df, &quot;?&quot;).printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- s.s1: struct (nullable = true)</span>
<span class="sd">         |    |-- a.a1: integer (nullable = true)</span>
<span class="sd">         |    |-- b.b1: integer (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The idea is to recursively write a &quot;SELECT struct(a, struct(s.b.c, s.b.d)) as s&quot; for each nested column.</span>
    <span class="c1"># There is a little twist as we don&#39;t want to rebuild the struct if all its fields are null, so we add a CASE WHEN</span>

    <span class="k">def</span> <span class="nf">has_structs</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">struct_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">dataType</span><span class="p">,</span> <span class="n">StructType</span><span class="p">)]</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">struct_fields</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">has_structs</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">tree</span> <span class="o">=</span> <span class="n">_build_nested_struct_tree</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">separator</span><span class="p">)</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">_build_struct_from_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">separator</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.transformations_impl.with_generic_typed_struct.with_generic_typed_struct" class="doc doc-heading">
<code class="highlight language-python"><span class="n">with_generic_typed_struct</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Transform the specified struct columns of a given <a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">Dataframe</a> into
generic typed struct columns with the following generic schema
(based on <a href="https://spark.apache.org/docs/latest/sql-ref-datatypes.html">https://spark.apache.org/docs/latest/sql-ref-datatypes.html</a>) :</p>
<pre><code>STRUCT&lt;
    key: STRING, -- (name of the field inside the struct)
    type: STRING, -- (type of the field inside the struct)
    value: STRUCT&lt; -- (all the fields will be null except for the one with the correct type)
        date: DATE,
        timestamp: TIMESTAMP,
        int: LONG,
        float: DOUBLE,
        boolean: BOOLEAN,
        string: STRING,
        bytes: BINARY
    &gt;
&gt;
</code></pre>
<p>The following spark types will be automatically cast into the more generic following types:</p>
<ul>
<li><code>tinyint</code>, <code>smallint</code>, <code>int</code> -&gt; <code>bigint</code></li>
<li><code>float</code>, <code>decimal</code> -&gt; <code>double</code></li>
</ul>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>The Dataframe to transform</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>col_names</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>A list of column names to transform</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
          </td>
          <td><p>A Dataframe with the columns transformed into generic typed structs</p></td>
        </tr>
    </tbody>
  </table>
      <div class="admonition warning">
<p class="admonition-title">Limitations</p>
<p>Currently, complex field types (structs, maps, arrays) are not supported.
All fields of the struct columns to convert must be of basic types.</p>
</div>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;doctest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;first.name&quot;</span><span class="p">:</span> <span class="s2">&quot;Jacques&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;is.an.adult&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span>
<span class="gp">... </span>     <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;first.name&quot;</span><span class="p">:</span> <span class="s2">&quot;Michel&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;is.an.adult&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}),</span>
<span class="gp">... </span>     <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;first.name&quot;</span><span class="p">:</span> <span class="s2">&quot;Marie&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span> <span class="s2">&quot;is.an.adult&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})],</span>
<span class="gp">... </span>    <span class="s2">&quot;id INT, `person.struct` STRUCT&lt;`first.name`:STRING, age:INT, `is.an.adult`:BOOLEAN&gt;&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">+---+-------------------+</span>
<span class="go">|id |person.struct      |</span>
<span class="go">+---+-------------------+</span>
<span class="go">|1  |{Jacques, 25, true}|</span>
<span class="go">|2  |{Michel, 12, false}|</span>
<span class="go">|3  |{Marie, 36, true}  |</span>
<span class="go">+---+-------------------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">with_generic_typed_struct</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;`person.struct`&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
<span class="go">root</span>
<span class="go"> |-- id: integer (nullable = true)</span>
<span class="go"> |-- person.struct: array (nullable = false)</span>
<span class="go"> |    |-- element: struct (containsNull = false)</span>
<span class="go"> |    |    |-- key: string (nullable = false)</span>
<span class="go"> |    |    |-- type: string (nullable = false)</span>
<span class="go"> |    |    |-- value: struct (nullable = false)</span>
<span class="go"> |    |    |    |-- boolean: boolean (nullable = true)</span>
<span class="go"> |    |    |    |-- bytes: binary (nullable = true)</span>
<span class="go"> |    |    |    |-- date: date (nullable = true)</span>
<span class="go"> |    |    |    |-- float: double (nullable = true)</span>
<span class="go"> |    |    |    |-- int: long (nullable = true)</span>
<span class="go"> |    |    |    |-- string: string (nullable = true)</span>
<span class="go"> |    |    |    |-- timestamp: timestamp (nullable = true)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># noqa: E501</span>
<span class="go">+---+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="go">|id |person.struct                                                                                                                                                                                  |</span>
<span class="go">+---+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="go">|1  |[{first.name, string, {null, null, null, null, null, Jacques, null}}, {age, int, {null, null, null, null, 25, null, null}}, {is.an.adult, boolean, {true, null, null, null, null, null, null}}]|</span>
<span class="go">|2  |[{first.name, string, {null, null, null, null, null, Michel, null}}, {age, int, {null, null, null, null, 12, null, null}}, {is.an.adult, boolean, {false, null, null, null, null, null, null}}]|</span>
<span class="go">|3  |[{first.name, string, {null, null, null, null, null, Marie, null}}, {age, int, {null, null, null, null, 36, null, null}}, {is.an.adult, boolean, {true, null, null, null, null, null, null}}]  |</span>
<span class="go">+---+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>spark_frame/transformations_impl/with_generic_typed_struct.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">with_generic_typed_struct</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Transform the specified struct columns of a given [Dataframe][pyspark.sql.DataFrame] into</span>
<span class="sd">    generic typed struct columns with the following generic schema</span>
<span class="sd">    (based on [https://spark.apache.org/docs/latest/sql-ref-datatypes.html](</span>
<span class="sd">    https://spark.apache.org/docs/latest/sql-ref-datatypes.html)) :</span>

<span class="sd">        STRUCT&lt;</span>
<span class="sd">            key: STRING, -- (name of the field inside the struct)</span>
<span class="sd">            type: STRING, -- (type of the field inside the struct)</span>
<span class="sd">            value: STRUCT&lt; -- (all the fields will be null except for the one with the correct type)</span>
<span class="sd">                date: DATE,</span>
<span class="sd">                timestamp: TIMESTAMP,</span>
<span class="sd">                int: LONG,</span>
<span class="sd">                float: DOUBLE,</span>
<span class="sd">                boolean: BOOLEAN,</span>
<span class="sd">                string: STRING,</span>
<span class="sd">                bytes: BINARY</span>
<span class="sd">            &gt;</span>
<span class="sd">        &gt;</span>

<span class="sd">    The following spark types will be automatically cast into the more generic following types:</span>

<span class="sd">    - `tinyint`, `smallint`, `int` -&gt; `bigint`</span>
<span class="sd">    - `float`, `decimal` -&gt; `double`</span>

<span class="sd">    Args:</span>
<span class="sd">        df: The Dataframe to transform</span>
<span class="sd">        col_names: A list of column names to transform</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Dataframe with the columns transformed into generic typed structs</span>

<span class="sd">    !!! warning &quot;Limitations&quot;</span>
<span class="sd">        Currently, complex field types (structs, maps, arrays) are not supported.</span>
<span class="sd">        All fields of the struct columns to convert must be of basic types.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from pyspark.sql import SparkSession</span>
<span class="sd">        &gt;&gt;&gt; spark = SparkSession.builder.appName(&quot;doctest&quot;).getOrCreate()</span>
<span class="sd">        &gt;&gt;&gt; df = spark.createDataFrame(</span>
<span class="sd">        ...     [(1, {&quot;first.name&quot;: &quot;Jacques&quot;, &quot;age&quot;: 25, &quot;is.an.adult&quot;: True}),</span>
<span class="sd">        ...      (2, {&quot;first.name&quot;: &quot;Michel&quot;, &quot;age&quot;: 12, &quot;is.an.adult&quot;: False}),</span>
<span class="sd">        ...      (3, {&quot;first.name&quot;: &quot;Marie&quot;, &quot;age&quot;: 36, &quot;is.an.adult&quot;: True})],</span>
<span class="sd">        ...     &quot;id INT, `person.struct` STRUCT&lt;`first.name`:STRING, age:INT, `is.an.adult`:BOOLEAN&gt;&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; df.show(truncate=False)</span>
<span class="sd">        +---+-------------------+</span>
<span class="sd">        |id |person.struct      |</span>
<span class="sd">        +---+-------------------+</span>
<span class="sd">        |1  |{Jacques, 25, true}|</span>
<span class="sd">        |2  |{Michel, 12, false}|</span>
<span class="sd">        |3  |{Marie, 36, true}  |</span>
<span class="sd">        +---+-------------------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; res = with_generic_typed_struct(df, [&quot;`person.struct`&quot;])</span>
<span class="sd">        &gt;&gt;&gt; res.printSchema()</span>
<span class="sd">        root</span>
<span class="sd">         |-- id: integer (nullable = true)</span>
<span class="sd">         |-- person.struct: array (nullable = false)</span>
<span class="sd">         |    |-- element: struct (containsNull = false)</span>
<span class="sd">         |    |    |-- key: string (nullable = false)</span>
<span class="sd">         |    |    |-- type: string (nullable = false)</span>
<span class="sd">         |    |    |-- value: struct (nullable = false)</span>
<span class="sd">         |    |    |    |-- boolean: boolean (nullable = true)</span>
<span class="sd">         |    |    |    |-- bytes: binary (nullable = true)</span>
<span class="sd">         |    |    |    |-- date: date (nullable = true)</span>
<span class="sd">         |    |    |    |-- float: double (nullable = true)</span>
<span class="sd">         |    |    |    |-- int: long (nullable = true)</span>
<span class="sd">         |    |    |    |-- string: string (nullable = true)</span>
<span class="sd">         |    |    |    |-- timestamp: timestamp (nullable = true)</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        &gt;&gt;&gt; res.show(10, False) # noqa: E501</span>
<span class="sd">        +---+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="sd">        |id |person.struct                                                                                                                                                                                  |</span>
<span class="sd">        +---+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="sd">        |1  |[{first.name, string, {null, null, null, null, null, Jacques, null}}, {age, int, {null, null, null, null, 25, null, null}}, {is.an.adult, boolean, {true, null, null, null, null, null, null}}]|</span>
<span class="sd">        |2  |[{first.name, string, {null, null, null, null, null, Michel, null}}, {age, int, {null, null, null, null, 12, null, null}}, {is.an.adult, boolean, {false, null, null, null, null, null, null}}]|</span>
<span class="sd">        |3  |[{first.name, string, {null, null, null, null, null, Marie, null}}, {age, int, {null, null, null, null, 36, null, null}}, {is.an.adult, boolean, {true, null, null, null, null, null, null}}]  |</span>
<span class="sd">        +---+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">source_to_cast</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tinyint&quot;</span><span class="p">:</span> <span class="s2">&quot;bigint&quot;</span><span class="p">,</span>
        <span class="s2">&quot;smallint&quot;</span><span class="p">:</span> <span class="s2">&quot;bigint&quot;</span><span class="p">,</span>
        <span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="s2">&quot;bigint&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bigint&quot;</span><span class="p">:</span> <span class="s2">&quot;bigint&quot;</span><span class="p">,</span>
        <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span>
        <span class="s2">&quot;double&quot;</span><span class="p">:</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span>
        <span class="s2">&quot;boolean&quot;</span><span class="p">:</span> <span class="s2">&quot;boolean&quot;</span><span class="p">,</span>
        <span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="s2">&quot;binary&quot;</span><span class="p">:</span> <span class="s2">&quot;binary&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Mapping indicating for each source Spark DataTypes the type into which it will be cast.&quot;&quot;&quot;</span>

    <span class="n">cast_to_name</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;binary&quot;</span><span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bigint&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
        <span class="s2">&quot;double&quot;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Mapping indicating for each already cast Spark DataTypes the name of the corresponding field.</span>
<span class="sd">    When missing, the same name will be kept.&quot;&quot;&quot;</span>

    <span class="n">name_cast</span> <span class="o">=</span> <span class="p">{</span><span class="n">cast_to_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> <span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">source_to_cast</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>
    <span class="c1"># We make sure the types are sorted</span>
    <span class="n">name_cast</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">name_cast</span><span class="o">.</span><span class="n">items</span><span class="p">())}</span>

    <span class="k">def</span> <span class="nf">match_regex_types</span><span class="p">(</span><span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Matches the source types against regexes to identify more complex types (like Decimal(x, y))&quot;&quot;&quot;</span>
        <span class="n">regex_to_cast_types</span> <span class="o">=</span> <span class="p">[(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;decimal(.*)&quot;</span><span class="p">),</span> <span class="s2">&quot;float&quot;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">regex</span><span class="p">,</span> <span class="n">cast_type</span> <span class="ow">in</span> <span class="n">regex_to_cast_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">source_type</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cast_type</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">field_to_col</span><span class="p">(</span><span class="n">field</span><span class="p">:</span> <span class="n">StructField</span><span class="p">,</span> <span class="n">column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Transforms the specified field into a generic column&quot;&quot;&quot;</span>
        <span class="n">source_type</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">dataType</span><span class="o">.</span><span class="n">simpleString</span><span class="p">()</span>
        <span class="n">cast_type</span> <span class="o">=</span> <span class="n">source_to_cast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">source_type</span><span class="p">)</span>
        <span class="n">field_name</span> <span class="o">=</span> <span class="n">column_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">quote</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cast_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cast_type</span> <span class="o">=</span> <span class="n">match_regex_types</span><span class="p">(</span><span class="n">source_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cast_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: The field </span><span class="si">{field_name}</span><span class="s2"> is of type </span><span class="si">{source_type}</span><span class="s2"> which is currently unsupported. &quot;</span>
                <span class="s2">&quot;This field will be dropped.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="n">field_name</span><span class="p">,</span> <span class="n">source_type</span><span class="o">=</span><span class="n">source_type</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">name_type</span> <span class="o">=</span> <span class="n">cast_to_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cast_type</span><span class="p">,</span> <span class="n">cast_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">struct</span><span class="p">(</span>
            <span class="n">f</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">),</span>
            <span class="n">f</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">name_type</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span>
            <span class="c1"># In the code below, we use f.expr instead of f.col because it looks like f.col</span>
            <span class="c1"># does not support column names with backquotes in them, but f.expr does :-p</span>
            <span class="n">f</span><span class="o">.</span><span class="n">struct</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">name_type</span> <span class="o">==</span> <span class="n">name_t</span> <span class="k">else</span> <span class="n">f</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">cast_t</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">name_t</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">name_t</span><span class="p">,</span> <span class="n">cast_t</span> <span class="ow">in</span> <span class="n">name_cast</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">col_names</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">get_nested_col_type_from_schema</span><span class="p">(</span><span class="n">col_name</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
        <span class="n">assert_true</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">StructType</span><span class="p">))</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">StructType</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_to_col</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">col_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">]</span>
        <span class="n">columns_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">unquote</span><span class="p">(</span><span class="n">col_name</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="o">*</span><span class="n">columns_2</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />
<h2 id="spark_frameschema_utils">spark_frame.schema_utils</h2>
<p>This module contains methods useful for manipulating DataFrame schemas.</p>
<hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.schema_utils.schema_from_json" class="doc doc-heading">
<code class="highlight language-python"><span class="n">schema_from_json</span><span class="p">(</span><span class="n">json_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StructType</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Parses the given json string representing a Spark :class:<code>StructType</code>.</p>
<p>Only schema representing StructTypes can be parsed, this means that
<code>schema_from_json(schema_to_json(data_type))</code> will crash if <code>data_type</code> is not a StructType.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>json_string</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>A string representation of a DataFrame schema.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.types.StructType" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.types.StructType.html#pyspark.sql.types.StructType">StructType</a></code>
          </td>
          <td><p>A StructType object representing the DataFrame schema</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_json</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;{&quot;fields&quot;:[</span>
<span class="gp">... </span><span class="s1">    {&quot;metadata&quot;:</span><span class="si">{}</span><span class="s1">,&quot;name&quot;:&quot;a&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;byte&quot;},</span>
<span class="gp">... </span><span class="s1">    {&quot;metadata&quot;:</span><span class="si">{}</span><span class="s1">,&quot;name&quot;:&quot;b&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;decimal(16,8)&quot;}</span>
<span class="gp">... </span><span class="s1">],&quot;type&quot;:&quot;struct&quot;}&#39;&#39;&#39;</span><span class="p">)</span>
<span class="go">StructType([StructField(&#39;a&#39;, ByteType(), True), StructField(&#39;b&#39;, DecimalType(16,8), True)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_json</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;{&quot;fields&quot;:[</span>
<span class="gp">... </span><span class="s1">    {&quot;metadata&quot;:</span><span class="si">{}</span><span class="s1">,&quot;name&quot;:&quot;a&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;double&quot;},</span>
<span class="gp">... </span><span class="s1">    {&quot;metadata&quot;:</span><span class="si">{}</span><span class="s1">,&quot;name&quot;:&quot;b&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;string&quot;}</span>
<span class="gp">... </span><span class="s1">],&quot;type&quot;:&quot;struct&quot;}&#39;&#39;&#39;</span><span class="p">)</span>
<span class="go">StructType([StructField(&#39;a&#39;, DoubleType(), True), StructField(&#39;b&#39;, StringType(), True)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_json</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;{&quot;fields&quot;:[</span>
<span class="gp">... </span><span class="s1">{&quot;metadata&quot;:</span><span class="si">{}</span><span class="s1">,&quot;name&quot;:&quot;a&quot;,&quot;nullable&quot;:true,&quot;type&quot;:{</span>
<span class="gp">... </span><span class="s1">    &quot;containsNull&quot;:true,&quot;elementType&quot;:&quot;short&quot;,&quot;type&quot;:&quot;array&quot;</span>
<span class="gp">... </span><span class="s1">}}</span>
<span class="gp">... </span><span class="s1">],&quot;type&quot;:&quot;struct&quot;}&#39;&#39;&#39;</span><span class="p">)</span>
<span class="go">StructType([StructField(&#39;a&#39;, ArrayType(ShortType(), True), True)])</span>
</code></pre></div>
    <p><strong>Error cases:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_json</span><span class="p">(</span><span class="s1">&#39;&quot;integer&quot;&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">string indices must be integers</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_json</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;{&quot;keyType&quot;:&quot;string&quot;,&quot;type&quot;:&quot;map&quot;,</span>
<span class="gp">... </span><span class="s1">&quot;valueContainsNull&quot;:true,&quot;valueType&quot;:&quot;string&quot;}&#39;&#39;&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">KeyError</span>: <span class="n">&#39;fields&#39;</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>spark_frame/schema_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schema_from_json</span><span class="p">(</span><span class="n">json_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StructType</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Parses the given json string representing a Spark :class:`StructType`.</span>

<span class="sd">    Only schema representing StructTypes can be parsed, this means that</span>
<span class="sd">    `schema_from_json(schema_to_json(data_type))` will crash if `data_type` is not a StructType.</span>

<span class="sd">    Args:</span>
<span class="sd">        json_string: A string representation of a DataFrame schema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A StructType object representing the DataFrame schema</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; schema_from_json(&#39;&#39;&#39;{&quot;fields&quot;:[</span>
<span class="sd">        ...     {&quot;metadata&quot;:{},&quot;name&quot;:&quot;a&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;byte&quot;},</span>
<span class="sd">        ...     {&quot;metadata&quot;:{},&quot;name&quot;:&quot;b&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;decimal(16,8)&quot;}</span>
<span class="sd">        ... ],&quot;type&quot;:&quot;struct&quot;}&#39;&#39;&#39;)</span>
<span class="sd">        StructType([StructField(&#39;a&#39;, ByteType(), True), StructField(&#39;b&#39;, DecimalType(16,8), True)])</span>
<span class="sd">        &gt;&gt;&gt; schema_from_json(&#39;&#39;&#39;{&quot;fields&quot;:[</span>
<span class="sd">        ...     {&quot;metadata&quot;:{},&quot;name&quot;:&quot;a&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;double&quot;},</span>
<span class="sd">        ...     {&quot;metadata&quot;:{},&quot;name&quot;:&quot;b&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;string&quot;}</span>
<span class="sd">        ... ],&quot;type&quot;:&quot;struct&quot;}&#39;&#39;&#39;)</span>
<span class="sd">        StructType([StructField(&#39;a&#39;, DoubleType(), True), StructField(&#39;b&#39;, StringType(), True)])</span>
<span class="sd">        &gt;&gt;&gt; schema_from_json(&#39;&#39;&#39;{&quot;fields&quot;:[</span>
<span class="sd">        ... {&quot;metadata&quot;:{},&quot;name&quot;:&quot;a&quot;,&quot;nullable&quot;:true,&quot;type&quot;:{</span>
<span class="sd">        ...     &quot;containsNull&quot;:true,&quot;elementType&quot;:&quot;short&quot;,&quot;type&quot;:&quot;array&quot;</span>
<span class="sd">        ... }}</span>
<span class="sd">        ... ],&quot;type&quot;:&quot;struct&quot;}&#39;&#39;&#39;)</span>
<span class="sd">        StructType([StructField(&#39;a&#39;, ArrayType(ShortType(), True), True)])</span>

<span class="sd">        **Error cases:**</span>

<span class="sd">        &gt;&gt;&gt; schema_from_json(&#39;&quot;integer&quot;&#39;) # doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">          ...</span>
<span class="sd">        TypeError: string indices must be integers</span>
<span class="sd">        &gt;&gt;&gt; schema_from_json(&#39;&#39;&#39;{&quot;keyType&quot;:&quot;string&quot;,&quot;type&quot;:&quot;map&quot;,</span>
<span class="sd">        ... &quot;valueContainsNull&quot;:true,&quot;valueType&quot;:&quot;string&quot;}&#39;&#39;&#39;) # doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">          ...</span>
<span class="sd">        KeyError: &#39;fields&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">StructType</span><span class="o">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_string</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.schema_utils.schema_from_simple_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">schema_from_simple_string</span><span class="p">(</span><span class="n">schema_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataType</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Parses the given data type string to a :class:<code>DataType</code>. The data type string format equals
<a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.types.DataType.html#pyspark.sql.types.DataType.simpleString">pyspark.sql.types.DataType.simpleString</a>, except that the top level struct type can omit
the <code>struct&lt;&gt;</code>.
This method requires the SparkSession to have already been instantiated.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>schema_string</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>A simpleString representing a DataFrame schema.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.types.DataType" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.types.DataType.html#pyspark.sql.types.DataType">DataType</a></code>
          </td>
          <td><p>A DataType object representing the DataFrame schema.</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>AssertionError</code>
          </td>
          <td><p>If no SparkContext has been instantiated first.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;doctest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_simple_string</span><span class="p">(</span><span class="s2">&quot;int &quot;</span><span class="p">)</span>
<span class="go">IntegerType()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_simple_string</span><span class="p">(</span><span class="s2">&quot;INT &quot;</span><span class="p">)</span>
<span class="go">IntegerType()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_simple_string</span><span class="p">(</span><span class="s2">&quot;a: byte, b: decimal(  16 , 8   ) &quot;</span><span class="p">)</span>
<span class="go">StructType([StructField(&#39;a&#39;, ByteType(), True), StructField(&#39;b&#39;, DecimalType(16,8), True)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_simple_string</span><span class="p">(</span><span class="s2">&quot;a DOUBLE, b STRING&quot;</span><span class="p">)</span>
<span class="go">StructType([StructField(&#39;a&#39;, DoubleType(), True), StructField(&#39;b&#39;, StringType(), True)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_simple_string</span><span class="p">(</span><span class="s2">&quot;a: array&lt; short&gt;&quot;</span><span class="p">)</span>
<span class="go">StructType([StructField(&#39;a&#39;, ArrayType(ShortType(), True), True)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_simple_string</span><span class="p">(</span><span class="s2">&quot; map&lt;string , string &gt; &quot;</span><span class="p">)</span>
<span class="go">MapType(StringType(), StringType(), True)</span>
</code></pre></div>
    <p><strong>Error cases:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_simple_string</span><span class="p">(</span><span class="s2">&quot;blabla&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="err">pyspark.sql.utils.ParseException:...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_simple_string</span><span class="p">(</span><span class="s2">&quot;a: int,&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="err">pyspark.sql.utils.ParseException:...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_simple_string</span><span class="p">(</span><span class="s2">&quot;array&lt;int&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="err">pyspark.sql.utils.ParseException:...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_from_simple_string</span><span class="p">(</span><span class="s2">&quot;map&lt;int, boolean&gt;&gt;&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="err">pyspark.sql.utils.ParseException:...</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>spark_frame/schema_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schema_from_simple_string</span><span class="p">(</span><span class="n">schema_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataType</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Parses the given data type string to a :class:`DataType`. The data type string format equals</span>
<span class="sd">    [pyspark.sql.types.DataType.simpleString][], except that the top level struct type can omit</span>
<span class="sd">    the ``struct&lt;&gt;``.</span>
<span class="sd">    This method requires the SparkSession to have already been instantiated.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema_string: A simpleString representing a DataFrame schema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A DataType object representing the DataFrame schema.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AssertionError: If no SparkContext has been instantiated first.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from pyspark.sql import SparkSession</span>
<span class="sd">        &gt;&gt;&gt; spark = SparkSession.builder.appName(&quot;doctest&quot;).getOrCreate()</span>
<span class="sd">        &gt;&gt;&gt; schema_from_simple_string(&quot;int &quot;)</span>
<span class="sd">        IntegerType()</span>
<span class="sd">        &gt;&gt;&gt; schema_from_simple_string(&quot;INT &quot;)</span>
<span class="sd">        IntegerType()</span>
<span class="sd">        &gt;&gt;&gt; schema_from_simple_string(&quot;a: byte, b: decimal(  16 , 8   ) &quot;)</span>
<span class="sd">        StructType([StructField(&#39;a&#39;, ByteType(), True), StructField(&#39;b&#39;, DecimalType(16,8), True)])</span>
<span class="sd">        &gt;&gt;&gt; schema_from_simple_string(&quot;a DOUBLE, b STRING&quot;)</span>
<span class="sd">        StructType([StructField(&#39;a&#39;, DoubleType(), True), StructField(&#39;b&#39;, StringType(), True)])</span>
<span class="sd">        &gt;&gt;&gt; schema_from_simple_string(&quot;a: array&lt; short&gt;&quot;)</span>
<span class="sd">        StructType([StructField(&#39;a&#39;, ArrayType(ShortType(), True), True)])</span>
<span class="sd">        &gt;&gt;&gt; schema_from_simple_string(&quot; map&lt;string , string &gt; &quot;)</span>
<span class="sd">        MapType(StringType(), StringType(), True)</span>

<span class="sd">        **Error cases:**</span>

<span class="sd">        &gt;&gt;&gt; schema_from_simple_string(&quot;blabla&quot;) # doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">          ...</span>
<span class="sd">        pyspark.sql.utils.ParseException:...</span>
<span class="sd">        &gt;&gt;&gt; schema_from_simple_string(&quot;a: int,&quot;) # doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">          ...</span>
<span class="sd">        pyspark.sql.utils.ParseException:...</span>
<span class="sd">        &gt;&gt;&gt; schema_from_simple_string(&quot;array&lt;int&quot;) # doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">          ...</span>
<span class="sd">        pyspark.sql.utils.ParseException:...</span>
<span class="sd">        &gt;&gt;&gt; schema_from_simple_string(&quot;map&lt;int, boolean&gt;&gt;&quot;) # doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">          ...</span>
<span class="sd">        pyspark.sql.utils.ParseException:...</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">SparkContext</span><span class="o">.</span><span class="n">_active_spark_context</span>
    <span class="n">assert_true</span><span class="p">(</span><span class="n">sc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;No SparkContext has been instantiated yet&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_parse_datatype_string</span><span class="p">(</span><span class="n">schema_string</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.schema_utils.schema_to_json" class="doc doc-heading">
<code class="highlight language-python"><span class="n">schema_to_json</span><span class="p">(</span><span class="n">schema</span><span class="p">:</span> <span class="n">DataType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Convert the given datatype into a json string.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>schema</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.types.DataType" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.types.DataType.html#pyspark.sql.types.DataType">DataType</a></code>
          </td>
          <td><p>A DataFrame schema.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td><p>A single-line json string representing the DataFrame schema.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_to_json</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">())</span>
<span class="go">&#39;&quot;integer&quot;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_to_json</span><span class="p">(</span><span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">ByteType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span> <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">DecimalType</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="kc">True</span><span class="p">)]))</span>
<span class="go">&#39;{&quot;fields&quot;:[{&quot;metadata&quot;:{},&quot;name&quot;:&quot;a&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;byte&quot;},{&quot;metadata&quot;:{},&quot;name&quot;:&quot;b&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;decimal(16,8)&quot;}],&quot;type&quot;:&quot;struct&quot;}&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_to_json</span><span class="p">(</span><span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span> <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)]))</span>
<span class="go">&#39;{&quot;fields&quot;:[{&quot;metadata&quot;:{},&quot;name&quot;:&quot;a&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;double&quot;},{&quot;metadata&quot;:{},&quot;name&quot;:&quot;b&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;string&quot;}],&quot;type&quot;:&quot;struct&quot;}&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_to_json</span><span class="p">(</span><span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">ArrayType</span><span class="p">(</span><span class="n">ShortType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span> <span class="kc">True</span><span class="p">)]))</span>
<span class="go">&#39;{&quot;fields&quot;:[{&quot;metadata&quot;:{},&quot;name&quot;:&quot;a&quot;,&quot;nullable&quot;:true,&quot;type&quot;:{&quot;containsNull&quot;:true,&quot;elementType&quot;:&quot;short&quot;,&quot;type&quot;:&quot;array&quot;}}],&quot;type&quot;:&quot;struct&quot;}&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_to_json</span><span class="p">(</span><span class="n">MapType</span><span class="p">(</span><span class="n">StringType</span><span class="p">(),</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">))</span>
<span class="go">&#39;{&quot;keyType&quot;:&quot;string&quot;,&quot;type&quot;:&quot;map&quot;,&quot;valueContainsNull&quot;:true,&quot;valueType&quot;:&quot;string&quot;}&#39;</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>spark_frame/schema_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schema_to_json</span><span class="p">(</span><span class="n">schema</span><span class="p">:</span> <span class="n">DataType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Convert the given datatype into a json string.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema: A DataFrame schema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A single-line json string representing the DataFrame schema.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from pyspark.sql.types import *</span>
<span class="sd">        &gt;&gt;&gt; schema_to_json(IntegerType())</span>
<span class="sd">        &#39;&quot;integer&quot;&#39;</span>
<span class="sd">        &gt;&gt;&gt; schema_to_json(StructType([StructField(&#39;a&#39;, ByteType(), True), StructField(&#39;b&#39;, DecimalType(16,8), True)]))</span>
<span class="sd">        &#39;{&quot;fields&quot;:[{&quot;metadata&quot;:{},&quot;name&quot;:&quot;a&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;byte&quot;},{&quot;metadata&quot;:{},&quot;name&quot;:&quot;b&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;decimal(16,8)&quot;}],&quot;type&quot;:&quot;struct&quot;}&#39;</span>
<span class="sd">        &gt;&gt;&gt; schema_to_json(StructType([StructField(&#39;a&#39;, DoubleType(), True), StructField(&#39;b&#39;, StringType(), True)]))</span>
<span class="sd">        &#39;{&quot;fields&quot;:[{&quot;metadata&quot;:{},&quot;name&quot;:&quot;a&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;double&quot;},{&quot;metadata&quot;:{},&quot;name&quot;:&quot;b&quot;,&quot;nullable&quot;:true,&quot;type&quot;:&quot;string&quot;}],&quot;type&quot;:&quot;struct&quot;}&#39;</span>
<span class="sd">        &gt;&gt;&gt; schema_to_json(StructType([StructField(&#39;a&#39;, ArrayType(ShortType(), True), True)]))</span>
<span class="sd">        &#39;{&quot;fields&quot;:[{&quot;metadata&quot;:{},&quot;name&quot;:&quot;a&quot;,&quot;nullable&quot;:true,&quot;type&quot;:{&quot;containsNull&quot;:true,&quot;elementType&quot;:&quot;short&quot;,&quot;type&quot;:&quot;array&quot;}}],&quot;type&quot;:&quot;struct&quot;}&#39;</span>
<span class="sd">        &gt;&gt;&gt; schema_to_json(MapType(StringType(), StringType(), True))</span>
<span class="sd">        &#39;{&quot;keyType&quot;:&quot;string&quot;,&quot;type&quot;:&quot;map&quot;,&quot;valueContainsNull&quot;:true,&quot;valueType&quot;:&quot;string&quot;}&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">schema</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.schema_utils.schema_to_pretty_json" class="doc doc-heading">
<code class="highlight language-python"><span class="n">schema_to_pretty_json</span><span class="p">(</span><span class="n">schema</span><span class="p">:</span> <span class="n">DataType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Convert the given datatype into a pretty (indented) json string.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>schema</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.types.DataType" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.types.DataType.html#pyspark.sql.types.DataType">DataType</a></code>
          </td>
          <td><p>A DataFrame schema.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td><p>A multi-line indented json string representing the DataFrame schema.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">schema_to_pretty_json</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()))</span>
<span class="go">&quot;integer&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">schema_to_pretty_json</span><span class="p">(</span><span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">ArrayType</span><span class="p">(</span><span class="n">ShortType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span> <span class="kc">True</span><span class="p">)])))</span>
<span class="go">{</span>
<span class="go">  &quot;fields&quot;: [</span>
<span class="go">    {</span>
<span class="go">      &quot;metadata&quot;: {},</span>
<span class="go">      &quot;name&quot;: &quot;a&quot;,</span>
<span class="go">      &quot;nullable&quot;: true,</span>
<span class="go">      &quot;type&quot;: {</span>
<span class="go">        &quot;containsNull&quot;: true,</span>
<span class="go">        &quot;elementType&quot;: &quot;short&quot;,</span>
<span class="go">        &quot;type&quot;: &quot;array&quot;</span>
<span class="go">      }</span>
<span class="go">    }</span>
<span class="go">  ],</span>
<span class="go">  &quot;type&quot;: &quot;struct&quot;</span>
<span class="go">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">schema_to_pretty_json</span><span class="p">(</span><span class="n">MapType</span><span class="p">(</span><span class="n">StringType</span><span class="p">(),</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)))</span>
<span class="go">{</span>
<span class="go">  &quot;keyType&quot;: &quot;string&quot;,</span>
<span class="go">  &quot;type&quot;: &quot;map&quot;,</span>
<span class="go">  &quot;valueContainsNull&quot;: true,</span>
<span class="go">  &quot;valueType&quot;: &quot;string&quot;</span>
<span class="go">}</span>
</code></pre></div>
      <p>:param schema:
:return:</p>

      <details class="quote">
        <summary>Source code in <code>spark_frame/schema_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schema_to_pretty_json</span><span class="p">(</span><span class="n">schema</span><span class="p">:</span> <span class="n">DataType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Convert the given datatype into a pretty (indented) json string.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema: A DataFrame schema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A multi-line indented json string representing the DataFrame schema.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from pyspark.sql.types import *</span>
<span class="sd">        &gt;&gt;&gt; print(schema_to_pretty_json(IntegerType()))</span>
<span class="sd">        &quot;integer&quot;</span>
<span class="sd">        &gt;&gt;&gt; print(schema_to_pretty_json(StructType([StructField(&#39;a&#39;, ArrayType(ShortType(), True), True)])))</span>
<span class="sd">        {</span>
<span class="sd">          &quot;fields&quot;: [</span>
<span class="sd">            {</span>
<span class="sd">              &quot;metadata&quot;: {},</span>
<span class="sd">              &quot;name&quot;: &quot;a&quot;,</span>
<span class="sd">              &quot;nullable&quot;: true,</span>
<span class="sd">              &quot;type&quot;: {</span>
<span class="sd">                &quot;containsNull&quot;: true,</span>
<span class="sd">                &quot;elementType&quot;: &quot;short&quot;,</span>
<span class="sd">                &quot;type&quot;: &quot;array&quot;</span>
<span class="sd">              }</span>
<span class="sd">            }</span>
<span class="sd">          ],</span>
<span class="sd">          &quot;type&quot;: &quot;struct&quot;</span>
<span class="sd">        }</span>
<span class="sd">        &gt;&gt;&gt; print(schema_to_pretty_json(MapType(StringType(), StringType(), True)))</span>
<span class="sd">        {</span>
<span class="sd">          &quot;keyType&quot;: &quot;string&quot;,</span>
<span class="sd">          &quot;type&quot;: &quot;map&quot;,</span>
<span class="sd">          &quot;valueContainsNull&quot;: true,</span>
<span class="sd">          &quot;valueType&quot;: &quot;string&quot;</span>
<span class="sd">        }</span>

<span class="sd">    :param schema:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">schema_dict</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />


<div class="doc doc-object doc-function">



<h3 id="spark_frame.schema_utils.schema_to_simple_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">schema_to_simple_string</span><span class="p">(</span><span class="n">schema</span><span class="p">:</span> <span class="n">DataType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Convert the given datatype into a simple sql string.
This method is equivalent to calling <a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.types.DataType.html#pyspark.sql.types.DataType.simpleString"><code>schema.simpleString()</code></a> directly.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>schema</code></td>
          <td>
                <code><a class="autorefs autorefs-external" title="pyspark.sql.types.DataType" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.types.DataType.html#pyspark.sql.types.DataType">DataType</a></code>
          </td>
          <td><p>A DataFrame schema.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td><p>A simpleString representing the DataFrame schema.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_to_simple_string</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">())</span>
<span class="go">&#39;int&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_to_simple_string</span><span class="p">(</span><span class="n">StructType</span><span class="p">([</span>
<span class="gp">... </span>    <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">ByteType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">DecimalType</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span><span class="p">]))</span>
<span class="go">&#39;struct&lt;a:tinyint,b:decimal(16,8)&gt;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_to_simple_string</span><span class="p">(</span><span class="n">StructType</span><span class="p">([</span>
<span class="gp">... </span>    <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span><span class="p">]))</span>
<span class="go">&#39;struct&lt;a:double,b:string&gt;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_to_simple_string</span><span class="p">(</span><span class="n">StructType</span><span class="p">([</span><span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">ArrayType</span><span class="p">(</span><span class="n">ShortType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span> <span class="kc">True</span><span class="p">)]))</span>
<span class="go">&#39;struct&lt;a:array&lt;smallint&gt;&gt;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schema_to_simple_string</span><span class="p">(</span><span class="n">MapType</span><span class="p">(</span><span class="n">StringType</span><span class="p">(),</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">))</span>
<span class="go">&#39;map&lt;string,string&gt;&#39;</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>spark_frame/schema_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schema_to_simple_string</span><span class="p">(</span><span class="n">schema</span><span class="p">:</span> <span class="n">DataType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Convert the given datatype into a simple sql string.</span>
<span class="sd">    This method is equivalent to calling [`schema.simpleString()`][pyspark.sql.types.DataType.simpleString] directly.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema: A DataFrame schema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A simpleString representing the DataFrame schema.</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; from pyspark.sql.types import *</span>
<span class="sd">        &gt;&gt;&gt; schema_to_simple_string(IntegerType())</span>
<span class="sd">        &#39;int&#39;</span>
<span class="sd">        &gt;&gt;&gt; schema_to_simple_string(StructType([</span>
<span class="sd">        ...     StructField(&#39;a&#39;, ByteType(), True),</span>
<span class="sd">        ...     StructField(&#39;b&#39;, DecimalType(16,8), True)</span>
<span class="sd">        ... ]))</span>
<span class="sd">        &#39;struct&lt;a:tinyint,b:decimal(16,8)&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; schema_to_simple_string(StructType([</span>
<span class="sd">        ...     StructField(&#39;a&#39;, DoubleType(), True),</span>
<span class="sd">        ...     StructField(&#39;b&#39;, StringType(), True)</span>
<span class="sd">        ... ]))</span>
<span class="sd">        &#39;struct&lt;a:double,b:string&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; schema_to_simple_string(StructType([StructField(&#39;a&#39;, ArrayType(ShortType(), True), True)]))</span>
<span class="sd">        &#39;struct&lt;a:array&lt;smallint&gt;&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; schema_to_simple_string(MapType(StringType(), StringType(), True))</span>
<span class="sd">        &#39;map&lt;string,string&gt;&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">schema</span><span class="o">.</span><span class="n">simpleString</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><hr />





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../use_cases/working_with_json/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Working with json" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Working with json
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
    
  </body>
</html>